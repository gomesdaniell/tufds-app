<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>App TUFDS ‚Äì Consulentes</title>

<!-- polyfill para manter google.script.run (n√£o quebra se n√£o existir) -->
<script src="/gsrun.js"></script>

<style>
  :root{
    --bg:#f3f4f6;
    --card:#ffffff;
    --text:#111827;
    --muted:#6b7280;
    --border:#e5e7eb;
    --accent:#0f766e;
    --accent-soft:#ecfdf5;
    --shadow:0 1px 3px rgba(0,0,0,.06);
    --radius:16px;
  }

  *{ box-sizing:border-box }
  html,body{ height:100% }
  body{
    margin:0;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue","Noto Sans",Arial,"Apple Color Emoji","Segoe UI Emoji";
    background:var(--bg);
    color:var(--text);
  }

  /* ===== shell / columns ===== */
  .shell{
    max-width:1200px;
    margin:0 auto;
    padding:24px 16px 40px;
    display:grid;
    grid-template-columns: 1fr 320px; /* padr√£o: 2 colunas */
    gap:24px;
  }
  .shell.single{ grid-template-columns: 1fr; }
  @media (max-width: 1024px){ .shell{ grid-template-columns: 1fr } }

  .hidden{ display:none !important; }

  /* ===== header ===== */
  .header{
    grid-column:1 / -1;
    background:var(--card);
    border:1px solid var(--border);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:16px 20px;
    display:flex;
    align-items:center;
    gap:14px;
  }
 .logo-circle {
  width: 65px;
  height: 65px;
  border-radius: 50%;
  background: var(--accent-soft);
  border: 1px solid #a7f3d0;
  color: var(--accent);
  display: grid;
  place-items: center;
  font-weight: 800;
  font-size: 22px;
  flex: 0 0 56px;
  overflow: hidden;
}

/* LOGO: exibir imagem inteira, centralizada e proporcional */
.logo-circle img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  background: #fff; /* fundo neutro para √°reas transparentes */
  border-radius: 50%;
  display: block;
  padding: 4px; /* d√° leve respiro interno */
}

  .header h1{ margin:0;font-size:24px;line-height:1.15; }
  .sub{ color:var(--muted); margin-top:2px; font-size:14px }

  /* ===== tabs (menu principal com scroll horizontal) ===== */
  .tabs{
    grid-column: 1 / -1;
    display: flex;
    gap: 12px;
    margin-top: 12px;
    margin-bottom: 10px;
    padding: 6px 2px;
    white-space: nowrap;
    overflow-x: auto;
    overflow-y: hidden;
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
    position: relative;
    scrollbar-width: thin;               
    scrollbar-color: var(--border) transparent;
  }
  .tabs::-webkit-scrollbar{ height: 6px; }
  .tabs::-webkit-scrollbar-track{ background: transparent; }
  .tabs::-webkit-scrollbar-thumb{ background: var(--border); border-radius: 3px; }
  .tabs:hover::-webkit-scrollbar-thumb{ background: var(--accent); }
  .tabs::before,.tabs::after{
    content:""; position:absolute; top:0; bottom:8px; width:16px; pointer-events:none; z-index:0;
  }
  .tabs::before{ left:0; background:linear-gradient(to right, var(--bg, #fff), rgba(255,255,255,0)); }
  .tabs::after{ right:0; background:linear-gradient(to left, var(--bg, #fff), rgba(255,255,255,0)); }
  .tabs > *{ position:relative; z-index:1; }

  .tab-btn{
    display:inline-flex; align-items:center;
    border:1px solid var(--border); background:#fff; color:var(--text);
    padding:10px 16px; border-radius:999px; font-weight:600; font-size:15px; cursor:pointer; white-space:nowrap;
  }
  .tab-btn:focus{ outline:2px solid #d1fae5; outline-offset:2px; }
  .tab-btn.active{ background:var(--accent); border-color:var(--accent); color:#ecfdf5; }

  /* ===== cards ===== */
  .card{
    background:var(--card);
    border:1px solid var(--border);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:20px;
  }
  h2{ margin:0 0 8px 0; font-size:22px }
  .muted{ color:var(--muted); font-size:14px }

  /* ===== home grid ===== */
  .home-grid{
    margin-top:10px;
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:16px;
  }
  @media (max-width: 720px){ .home-grid{ grid-template-columns: 1fr } }

  .home-card{
    display:flex; align-items:center; gap:14px;
    background:#fff; border:1px solid var(--border);
    padding:18px; border-radius:14px; cursor:pointer;
    transition:transform .08s ease, background .15s ease;
  }
  .home-card:hover{ background:#f9fafb; transform:translateY(-1px) }
  .home-card-icon{
    width:44px;height:44px;border-radius:12px;
    display:grid;place-items:center;font-size:26px;background:#eef2ff;
  }
  .home-card strong{ font-size:18px; display:block; margin-bottom:4px }

  /* ===== sections ===== */
  .section{ display:none; }
  .section.active{ display:block; }
  .col-right .card + .card{ margin-top:16px }

  /* ===== calendario list ===== */
  .cal-toolbar{ display:flex; align-items:center; gap:10px; margin-bottom:10px; }
  .cal-select{ padding:8px 12px; border:1px solid var(--border); border-radius:10px; background:#fff; font-size:14px; }
  .cal-list{ display:flex; flex-direction:column; gap:12px }
  .cal-item{
    display:flex; gap:12px; align-items:center;
    background:#fff; border:1px solid var(--border); border-radius:12px; padding:12px;
  }
  .cal-date{
    min-width:78px; text-align:center; color:var(--accent);
    background:var(--accent-soft); border-radius:10px; padding:8px 6px; font-weight:700;
  }
  .cal-date .dia{ font-size:22px }
  .cal-title{ font-size:16px; font-weight:700 }

  /* ===== sidebar ===== */
  .side-title{ font-weight:800; font-size:26px; margin:0 0 8px 0 }
  .next-list{ display:flex; flex-direction:column; gap:10px; margin-top:6px }
  .next-item{
    background:#d1fae5; border-radius:14px; padding:10px 12px;
    display:flex; justify-content:space-between; gap:16px; align-items:center;
  }
  .next-date{ font-weight:600 }
  .next-badge{
    background:#10b981; color:#052e1b; font-weight:800;
    padding:6px 12px; border-radius:999px; white-space:nowrap;
  }

  /* ===== modal newsletter ===== */
  .newsletter-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,.55); display:flex; align-items:center; justify-content:center; z-index:50 }
  .newsletter-backdrop.hidden{ display:none }
  .newsletter-card{ background:#fff; width:min(420px,92%); padding:24px 20px; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.3) }
  .newsletter-card h2{ font-size:20px }
  #newsletter-email{ width:100%; padding:10px 12px; border:1px solid #ccc; border-radius:8px; margin-top:8px }
  .newsletter-actions{ display:flex; justify-content:flex-end; gap:8px; margin-top:12px }
  .btn-primario,.btn-secundario{ border:0; border-radius:999px; padding:8px 16px; font-size:14px; cursor:pointer }
  .btn-primario{ background:var(--accent); color:#fff }
  .btn-secundario{ background:#e5e7eb; color:#111827 }

  .sobre-panel{ display:none; }
  .sobre-panel.active{ display:block; }
</style>
</head>
<body>

<div class="shell" id="app-shell">

  <!-- Dentro do .header -->
<div class="header">
  <div class="logo-circle" id="tufds-logo">
    <img src="public/assets/logo-tufds.jpg" alt="Logotipo TUFDS" width="65" height="65" />
  </div>
  <div style="flex:1">
    <h1>TERREIRO DE UMBANDA FILHOS DO SAGRADO - TUFDS</h1>
    <div class="sub">Acolher √© ensinar. Servir √© compromisso</div>
  </div>

  <!-- Bot√£o de login -->
  <a href="public/login.html" class="btn-login">√Årea dos Filhos</a>
</div>

<style>
.btn-login{
  background:#0f766e;
  color:#fff;
  text-decoration:none;
  font-weight:600;
  padding:8px 14px;
  border-radius:999px;
  transition:background .2s;
}
.btn-login:hover{ background:#115e56; }
</style>



  <!-- TABS (com scroll horizontal) -->
  <div class="tabs" id="tabs">
    <button class="tab-btn active" data-tab="home">In√≠cio</button>
    <button class="tab-btn" data-tab="calendario">Calend√°rio</button>
    <button class="tab-btn" data-tab="pontos">Pontos Cantados</button>
    <button class="tab-btn" data-tab="playlists">Playlists</button>
    <button class="tab-btn" data-tab="pedidos">Pedidos</button>
    <button class="tab-btn" data-tab="doacoes">Doa√ß√µes</button>
    <button class="tab-btn" data-tab="biblioteca">Biblioteca</button>
    <button class="tab-btn" data-tab="sobre">Sobre a Casa</button>
    <button class="tab-btn" data-tab="orixas">Orix√°s</button>
    <button class="tab-btn" data-tab="faq">Perguntas Frequentes</button>
    <button class="tab-btn" data-tab="contato">Contato</button>
  </div>

  <!-- COLUNA ESQUERDA -->
  <div>

    <!-- HOME -->
    <div id="sec-home" class="section active">
      <h1 style="margin:6px 0 6px;font-size:32px;line-height:1.1">Novo na Umbanda? Comece por aqui.</h1>

      <div class="home-grid">
        <div class="home-card" id="card-primeiros">
          <div class="home-card-icon">üë£</div>
          <div>
            <strong>Primeiros passos</strong>
            <span class="muted">Orienta√ß√µes b√°sicas para sua primeira gira.</span>
          </div>
        </div>

        <div class="home-card" id="card-visitantes">
          <div class="home-card-icon">‚úÖ</div>
          <div>
            <strong>Orienta√ß√µes para visitantes</strong>
            <span class="muted">Como se portar e como pedir ajuda espiritual.</span>
          </div>
        </div>

        <div class="home-card" id="card-biblioteca">
          <div class="home-card-icon">üìö</div>
          <div>
            <strong>Biblioteca</strong>
            <span class="muted">Acesse apostilas, PDFs e materiais da casa.</span>
          </div>
        </div>

        <div class="home-card" id="card-historia">
          <div class="home-card-icon">üìñ</div>
          <div>
            <strong>Hist√≥ria da Umbanda</strong>
            <span class="muted">Origem, princ√≠pios e fundamentos.</span>
          </div>
        </div>

        <div class="home-card" id="card-hierarquia">
          <div class="home-card-icon">üßë‚Äçü§ù‚Äçüßë</div>
          <div>
            <strong>Hierarquia da Casa</strong>
            <span class="muted">Quem √© quem no TUFDS.</span>
          </div>
        </div>

        <div class="home-card" id="card-orixas">
          <div class="home-card-icon">‚ö°</div>
          <div>
            <strong>Orix√°s na Umbanda</strong>
            <span class="muted">For√ßas, linhas e fundamentos.</span>
          </div>
        </div>

        <div class="home-card" id="card-ritual">
          <div class="home-card-icon">üïØ</div>
          <div>
            <strong>Ritual da gira</strong>
            <span class="muted">Passo a passo da gira.</span>
          </div>
        </div>

        <div class="home-card" id="card-doacoes">
          <div class="home-card-icon">üíö</div>
          <div>
            <strong>Doa√ß√µes para a Casa</strong>
            <span class="muted">Veja o que o terreiro precisa e escolha como ajudar.</span>
          </div>
        </div>

        <div class="home-card" id="card-pedidos">
          <div class="home-card-icon">üåπ</div>
          <div>
            <strong>Pedidos de Velas e Rosas</strong>
            <span class="muted">Reserve rosas, velas e outros itens para a gira.</span>
          </div>
        </div>
      </div>
    </div>

    <!-- PEDIDOS -->
    <div id="sec-pedidos" class="section">
      <div class="card">
        <h2>Pedidos para Giras</h2>
        <div data-include="public/partials/Pedidos.html"></div>
      </div>
    </div>

    <!-- CALEND√ÅRIO -->
    <div id="sec-calendario" class="section">
      <div class="card">
        <h2>Calend√°rio de Giras</h2>
        <p class="muted">Datas puxadas automaticamente da aba Calend√°rio.</p>

        <div class="cal-toolbar">
          <label>Filtrar por m√™s:</label>
          <select id="calMesSelect" class="cal-select"><option value="">Todos</option></select>
        </div>
        <div id="calLista" class="cal-list"></div>
      </div>
    </div>

    <!-- DOA√á√ïES -->
    <div id="sec-doacoes" class="section">
      <div class="card">
        <h2>Doa√ß√µes</h2>
        <div data-include="public/partials/Doacoes.html"></div>
      </div>
    </div>

    <!-- BIBLIOTECA -->
    <div id="sec-biblioteca" class="section">
      <div class="card">
        <h2>Biblioteca</h2>
        <div data-include="public/partials/Biblioteca.html"></div>
      </div>
    </div>

    <!-- SOBRE -->
    <div id="sec-sobre" class="section">
      <div class="card" style="margin-bottom:12px">
        <div class="sobre-tabs">
          <button class="tab-btn sobre-tab-btn active" data-sobre="info">Sobre o TUFDS</button>
          <button class="tab-btn sobre-tab-btn" data-sobre="historia">Hist√≥ria da Umbanda</button>
          <button class="tab-btn sobre-tab-btn" data-sobre="visitantes">Orienta√ß√µes para Visitantes</button>
          <button class="tab-btn sobre-tab-btn" data-sobre="primeiros">Primeiros Passos</button>
          <button class="tab-btn sobre-tab-btn" data-sobre="hierarquia">Hierarquia da Casa</button>
          <button class="tab-btn sobre-tab-btn" data-sobre="ritual">Ritual da Gira</button>
        </div>
      </div>

      <div id="sobre-info" class="sobre-panel card active" data-include="public/partials/SobreTUFDS.html"></div>
      <div id="sobre-historia" class="sobre-panel card" data-include="public/partials/HistUmbanda.html"></div>
      <div id="sobre-visitantes" class="sobre-panel card" data-include="public/partials/Visitantes.html"></div>
      <div id="sobre-primeiros" class="sobre-panel card" data-include="public/partials/PrimeirosPassos.html"></div>
      <div id="sobre-hierarquia" class="sobre-panel card" data-include="public/partials/Hierarquia.html"></div>
      <div id="sobre-ritual" class="sobre-panel card" data-include="public/partials/RitualTUFDS.html"></div>
    </div>

    <!-- ORIX√ÅS -->
    <div id="sec-orixas" class="section">
      <div class="card" data-include="public/partials/Orixas.html"></div>
    </div>

    <!-- PONTOS / PLAYLISTS / FAQ / CONTATO -->
    <div id="sec-pontos" class="section">
      <div class="card" data-include="public/partials/Pontos.html"></div>
    </div>

    <div id="sec-playlists" class="section">
      <div class="card"><h2>Playlists</h2></div>
    </div>

    <div id="sec-faq" class="section">
      <div class="card"><h2>Perguntas Frequentes</h2></div>
    </div>

    <div id="sec-contato" class="section">
      <div class="card" data-include="public/partials/Contato.html"></div>
    </div>

  </div>

  <!-- COLUNA DIREITA (s√≥ na Home) -->
  <aside class="col-right" id="side-panel">
    <div class="card">
      <h2 class="side-title">Espa√ßo do TUFDS</h2>
      <h3 style="margin:10px 0 8px">Pr√≥ximas giras</h3>
      <div id="homeProximasLista" class="next-list"></div>
    </div>
  </aside>

</div>

<!-- MODAL NEWSLETTER -->
<div id="newsletter-modal" class="newsletter-backdrop hidden">
  <div class="newsletter-card">
    <h2>Quer receber nossos avisos?</h2>
    <p>Deixe seu e-mail para receber comunicados do terreiro.</p>
    <input type="email" id="newsletter-email" placeholder="seuemail@exemplo.com" />
    <div class="newsletter-actions">
      <button type="button" onclick="fecharNewsletterModal()" class="btn-secundario">Agora n√£o</button>
      <button type="button" onclick="enviarNewsletterEmail()" class="btn-primario">Quero receber</button>
    </div>
  </div>
</div>

<script>
/* ===== includes (partials) ===== */
async function loadPartial(el) {
  const url = el.getAttribute('data-include');
  try {
    const resp = await fetch(url, { cache: 'no-store' });
    const html = await resp.text();
    el.innerHTML = html;

    const scripts = Array.from(el.querySelectorAll('script'));
    for (const old of scripts) {
      const s = document.createElement('script');
      if (old.type) s.type = old.type;
      if (old.src) s.src = old.src; else s.text = old.textContent || '';
      old.parentNode.replaceChild(s, old);
      await Promise.resolve();
    }

    el.dispatchEvent(new CustomEvent('partial:loaded', { bubbles:true, detail:{ url } }));

    if (url.includes('/partials/Orixas.html') && typeof window.initOrixas === 'function') {
      window.initOrixas(el);
    }
  } catch (e) {
    console.error('Erro ao carregar partial', url, e);
    el.innerHTML = '<p class="muted">Conte√∫do indispon√≠vel.</p>';
  }
}
document.querySelectorAll('[data-include]').forEach(loadPartial);

async function ensureIncludeLoaded(panelEl){
  if (!panelEl) return;
  const html = (panelEl.innerHTML || '').trim();
  if (html && !/Conte√∫do indispon√≠vel/i.test(html)) return;
  await loadPartial(panelEl);
}

/* ===== controla visibilidade do aside (s√≥ na Home) ===== */
const shell = document.getElementById('app-shell');
const sidePanel = document.getElementById('side-panel');
function setAsideVisible(on){
  if (!shell || !sidePanel) return;
  sidePanel.classList.toggle('hidden', !on);
  shell.classList.toggle('single', !on);
}

/* ===== ativa a aba Sobre + sub-aba espec√≠fica ===== */
async function abrirSobre(key){
  const btnSobre = document.querySelector('.tab-btn[data-tab="sobre"]');
  if (btnSobre) btnSobre.click();

  const btns    = document.querySelectorAll('.sobre-tab-btn');
  const panels  = document.querySelectorAll('.sobre-panel');
  const alvoBtn = document.querySelector(`.sobre-tab-btn[data-sobre="${key}"]`);
  const alvo    = document.getElementById(`sobre-${key}`);

  btns.forEach(b => b.classList.remove('active'));
  if (alvoBtn) alvoBtn.classList.add('active');

  panels.forEach(p => p.classList.remove('active'));
  if (alvo){
    alvo.classList.add('active');
    await ensureIncludeLoaded(alvo);
  }
}

/* ===== abas ===== */
const tabs = document.querySelectorAll('.tab-btn:not(.sobre-tab-btn)');
const sections = document.querySelectorAll('.section');

tabs.forEach(btn=>{
  btn.addEventListener('click', async ()=>{
    tabs.forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');

    const tab = btn.dataset.tab;
    sections.forEach(sec=>sec.classList.toggle('active', sec.id===`sec-${tab}`));

    setAsideVisible(tab === 'home');

    if (tab === 'calendario') {
      garanteCalendario();
    }
    if (tab === 'sobre') {
      const ativo = document.querySelector('.sobre-panel.active') || document.getElementById('sobre-info');
      await ensureIncludeLoaded(ativo);
    }
    if (tab === 'orixas') {
      const cont = document.querySelector('#sec-orixas [data-include="/partials/Orixas.html"]') || document.querySelector('#sec-orixas');
      if (typeof window.initOrixas === 'function' && cont) {
        window.initOrixas(cont);
      }
      cont?.addEventListener('partial:loaded', (ev)=>{
        if (ev.detail?.url?.includes('/partials/Orixas.html') && typeof window.initOrixas === 'function') {
          window.initOrixas(cont);
        }
      }, { once:true });
    }
  });
});

/* ===== delega√ß√£o para sub-abas (Sobre) ===== */
document.addEventListener('click', async (ev)=>{
  const btn = ev.target.closest('.sobre-tab-btn');
  if(!btn) return;
  const key = btn.dataset.sobre;
  await abrirSobre(key);
});

/* ===== atalhos dos cards ===== */
function openTab(tab){ document.querySelector(`.tab-btn[data-tab="${tab}"]`)?.click(); }

document.getElementById('card-doacoes')    ?.addEventListener('click', ()=> openTab('doacoes'));
document.getElementById('card-biblioteca') ?.addEventListener('click', ()=> openTab('biblioteca'));
document.getElementById('card-pedidos')    ?.addEventListener('click', ()=> openTab('pedidos'));
document.getElementById('card-historia')   ?.addEventListener('click', ()=> abrirSobre('historia'));
document.getElementById('card-visitantes') ?.addEventListener('click', ()=> abrirSobre('visitantes'));
document.getElementById('card-primeiros')  ?.addEventListener('click', ()=> abrirSobre('primeiros'));
document.getElementById('card-hierarquia') ?.addEventListener('click', ()=> abrirSobre('hierarquia'));
document.getElementById('card-ritual')     ?.addEventListener('click', ()=> abrirSobre('ritual'));
document.getElementById('card-orixas')     ?.addEventListener('click', ()=> openTab('orixas'));

/* ===== calend√°rio ===== */
let eventosCalendario = [];
let calJaBuscou = false;

const calSelect     = document.getElementById('calMesSelect');
const calLista      = document.getElementById('calLista');
const homeProxLista = document.getElementById('homeProximasLista');

function setLoadingCalendario(on=true){
  if(!calLista) return;
  calLista.innerHTML = on ? '<div class="muted">Carregando calend√°rio...</div>' : '';
}

function garanteCalendario(){
  if (!calJaBuscou || !eventosCalendario.length) {
    carregarCalendario();
  } else {
    montarFiltroMeses();
    renderCalendario();
    renderHomeProximas();
  }
}

async function carregarCalendario(){
  try {
    setLoadingCalendario(true);
    const res = await fetch('/api/getCalendarioEventos.js');
    const data = await res.json();

    calJaBuscou = true;
    eventosCalendario = data.eventos || [];
    montarFiltroMeses();
    renderCalendario();
    renderHomeProximas();
    setLoadingCalendario(false);

  } catch (err) {
    console.error('Erro ao carregar calend√°rio:', err);
    calLista && (calLista.innerHTML = `<div class="muted">
      Falha ao carregar a agenda. ${err?.message ? 'Detalhe: '+err.message : ''}
    </div>`);
  }
}

function montarFiltroMeses(){
  if(!calSelect) return;
  calSelect.innerHTML = '<option value="">Todos</option>';
  const nomes=['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'];
  const mapa={};
  (eventosCalendario||[]).forEach(ev=>{
    if(ev.mesAnoKey && !mapa[ev.mesAnoKey]){
      const [ano,mes]=ev.mesAnoKey.split('-');
      mapa[ev.mesAnoKey] = `${nomes[parseInt(mes,10)-1]}/${ano}`;
    }
  });
  Object.keys(mapa).sort().forEach(k=>{
    const o=document.createElement('option'); o.value=k; o.textContent=mapa[k];
    calSelect.appendChild(o);
  });
}

function renderCalendario(){
  if(!calLista) return;
  calLista.innerHTML='';
  let lista = eventosCalendario || [];
  if(calSelect?.value) lista = lista.filter(ev=>ev.mesAnoKey===calSelect.value);

  if(!lista.length){
    calLista.innerHTML='<div class="muted">Nenhuma gira neste m√™s.</div>';
    return;
  }

  lista.forEach(ev=>{
    let nome = ev.linha || ev.atividade || '';
    if((nome||'').toLowerCase().startsWith('atividade ')) nome = nome.substring(10);
    const [dia,mes,ano] = (ev.dataStr||'').split('/');
    const row=document.createElement('div');
    row.className='cal-item';
    row.innerHTML = `
      <div class="cal-date">
        <div class="dia">${dia||'--'}</div>
        <div>${mes||'--'}/${ano||'--'}</div>
      </div>
      <div class="cal-main">
        <div class="cal-title">Gira ${nome||''}</div>
      </div>`;
    calLista.appendChild(row);
  });
}
calSelect?.addEventListener('change', renderCalendario);

function renderHomeProximas(){
  if(!homeProxLista) return;
  homeProxLista.innerHTML='';
  if(!eventosCalendario.length){
    homeProxLista.innerHTML='<p class="muted">Sem giras cadastradas.</p>';
    return;
  }
  const hojeISO = new Date().toISOString().slice(0,10);
  const proximas = eventosCalendario.filter(ev=>ev.iso >= hojeISO).slice(0,4);
  proximas.forEach(ev=>{
    let nome = ev.linha || ev.atividade || '';
    if((nome||'').toLowerCase().startsWith('atividade ')) nome = nome.substring(10);
    const item = document.createElement('div');
    item.className = 'next-item';
    item.innerHTML = `<span class="next-date">${ev.dataStr}</span>
                      <span class="next-badge">Gira ${nome}</span>`;
    homeProxLista.appendChild(item);
  });
}

/* ===== newsletter ===== */
function abrirNewsletterModal(){ document.getElementById('newsletter-modal')?.classList.remove('hidden'); }
function fecharNewsletterModal(){ document.getElementById('newsletter-modal')?.classList.add('hidden'); localStorage.setItem('tufds_newsletter_shown','1'); }
function enviarNewsletterEmail(){ alert('Fun√ß√£o de newsletter desativada neste ambiente.'); }

/* ===== boot ===== */
document.addEventListener('DOMContentLoaded', ()=>{
  setAsideVisible(true);
  garanteCalendario();

  const jaMostrou = localStorage.getItem('tufds_newsletter_shown');
  if(!jaMostrou) abrirNewsletterModal();
});
</script>


</body>
</html>
