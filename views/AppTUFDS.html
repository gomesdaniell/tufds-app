<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>App TUFDS ‚Äì Consulentes</title>
<style>
  :root{
    --bg-body:#f3f4f6;
    --bg-card:#ffffff;
    --accent:#0f766e;
    --accent-soft:#ecfdf5;
    --text-main:#111827;
    --text-muted:#6b7280;
    --border-soft:#e5e7eb;
  }
  body{
    margin:0;
    font-family:Arial, sans-serif;
    background:var(--bg-body);
    color:var(--text-main);
  }
  .shell{
    max-width:1100px;
    margin:0 auto;
    padding:16px;
    display:flex;
    gap:24px;
  }

  /* COLUNAS */
  .col-left{ flex:3; }
  .col-right{ flex:1.2; }

  .header{
    display:flex;
    align-items:center;
    gap:12px;
    margin-bottom:16px;
    flex-wrap:wrap;
  }
  .logo-circle{
    width:52px;
    height:52px;
    border-radius:50%;
    background:var(--accent-soft);
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:800;
    color:var(--accent);
    font-size:22px;
    border:1px solid #a7f3d0;
    overflow:hidden;
  }
  .logo-circle .logo-img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
  }
  .header-text h1{ margin:0; font-size:20px; }
  .header-text .sub{ font-size:13px; color:var(--text-muted); }

  /* NAV */
  .tabs{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    margin-bottom:24px;
  }
  .tab-btn{
    border:1px solid var(--border-soft);
    border-radius:999px;
    padding:8px 16px;
    background:#fff;
    font-size:14px;
    cursor:pointer;
    color:var(--text-muted);
    font-weight:600;
  }
  .tab-btn.active{
    background:var(--accent);
    color:#ecfdf5;
    border-color:var(--accent);
  }

  .card{
    background:var(--bg-card);
    border-radius:16px;
    padding:20px;
    border:1px solid var(--border-soft);
    margin-bottom:16px;
    box-shadow:0 1px 3px rgba(0,0,0,0.06);
  }
  .card h2{ margin-top:0; font-size:20px; margin-bottom:8px; }
  .muted{ color:var(--text-muted); font-size:14px; }

  .section{ display:none; }
  .section.active{ display:block; }

  /* HOME */
  .home-grid{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:16px;
  }
  .home-card{
    background:#fff;
    border:1px solid var(--border-soft);
    border-radius:16px;
    padding:20px;
    display:flex;
    gap:12px;
    align-items:center;
    cursor:pointer;
    transition:0.2s;
  }
  .home-card:hover{ background:#f9fafb; }
  .home-card-icon{ font-size:32px; }

  /* CALEND√ÅRIO */
  .cal-toolbar{
    display:flex;
    align-items:center;
    gap:10px;
    margin-bottom:10px;
  }
  .cal-select{
    padding:6px 12px;
    border-radius:8px;
    border:1px solid var(--border-soft);
    background:#fff;
    font-size:14px;
  }
  .cal-list{
    display:flex;
    flex-direction:column;
    gap:12px;
  }
  .cal-item{
    display:flex;
    gap:12px;
    padding:12px;
    background:#fff;
    border:1px solid var(--border-soft);
    border-radius:12px;
  }
  .cal-date{
    min-width:70px;
    background:var(--accent-soft);
    padding:8px;
    text-align:center;
    border-radius:10px;
    font-weight:bold;
    color:var(--accent);
  }
  .cal-date .dia{ font-size:22px; }

  /* SOBRE */
  .sobre-tabs{ display:flex; gap:8px; flex-wrap:wrap; }
  .sobre-tab-btn{
    border:1px solid var(--border-soft);
    border-radius:999px;
    padding:6px 14px;
    font-size:13px;
    background:#fff;
    cursor:pointer;
    color:var(--text-muted);
    font-weight:600;
  }
  .sobre-tab-btn.active{ background:var(--accent); color:#fff; border-color:var(--accent); }
  .sobre-panel{ display:none; }
  .sobre-panel.active{ display:block; }

  /* MODAL NEWSLETTER */
  .newsletter-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.55);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
  }
  .newsletter-backdrop.hidden { display: none; }
  .newsletter-card {
    background: #ffffff;
    max-width: 420px;
    width: 90%;
    padding: 24px 20px;
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  }
  .newsletter-card h2 { margin: 0 0 8px 0; font-size: 20px; }
  .newsletter-card p { font-size: 14px; margin-bottom: 16px; }
  #newsletter-email {
    width: 100%;
    padding: 10px 12px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 14px;
    margin-bottom: 16px;
    box-sizing: border-box;
  }
  .newsletter-actions{
    display:flex; justify-content:flex-end; gap:8px; margin-top:8px;
  }
  .btn-primario, .btn-secundario{
    border:none; border-radius:999px; padding:8px 16px; font-size:14px; cursor:pointer;
  }
  .btn-primario{ background:#0f766e; color:#fff; }
  .btn-secundario{ background:#e5e7eb; color:#111827; }
</style>
</head>
<body>

<div class="shell">

  <div class="col-left">

    <!-- HEADER -->
    <div class="header">
      <div class="logo-circle">T</div>
      <div class="header-text">
        <h1>Terreiro de Umbanda Filhos do Sagrado - TUFDS</h1>
        <div class="sub">Espa√ßo de f√©, acolhimento e aprendizado.</div>
      </div>
    </div>

    <!-- TABS -->
    <div class="tabs">
      <button class="tab-btn active" data-tab="home">In√≠cio</button>
      <button class="tab-btn" data-tab="calendario">Calend√°rio</button>
      <button class="tab-btn" data-tab="pontos">Pontos Cantados</button>
      <button class="tab-btn" data-tab="playlists">Playlists</button>
      <button class="tab-btn" data-tab="pedidos">Pedidos</button>
      <button class="tab-btn" data-tab="doacoes">Doa√ß√µes</button>
      <button class="tab-btn" data-tab="biblioteca">Biblioteca</button>
      <button class="tab-btn" data-tab="sobre">Sobre a Casa</button>
      <button class="tab-btn" data-tab="orixas">Orix√°s</button>
      <button class="tab-btn" data-tab="faq">Perguntas Frequentes</button>
      <button class="tab-btn" data-tab="contato">Contato</button>
    </div>

    <!-- ======================= HOME ======================= -->
    <div id="sec-home" class="section active">
      <h1>Novo na Umbanda? Comece por aqui.</h1>

      <div class="home-grid">

        <div class="home-card clickable" id="card-primeiros">
          <div class="home-card-icon">üë£</div>
          <div>
            <strong>Primeiros passos</strong><br>
            <span class="muted">Orienta√ß√µes b√°sicas para sua primeira gira.</span>
          </div>
        </div>

        <div class="home-card clickable" id="card-visitantes">
          <div class="home-card-icon">‚úÖ</div>
          <div>
            <strong>Orienta√ß√µes para visitantes</strong><br>
            <span class="muted">Como se portar e como pedir ajuda espiritual.</span>
          </div>
        </div>

        <div class="home-card clickable" id="card-biblioteca">
          <div class="home-card-icon">üìö</div>
          <div>
            <strong>Biblioteca</strong><br>
            <span class="muted">Acesse apostilas, PDFs e materiais da casa.</span>
          </div>
        </div>

        <div class="home-card clickable" id="card-historia">
          <div class="home-card-icon">üìñ</div>
          <div>
            <strong>Hist√≥ria da Umbanda</strong><br>
            <span class="muted">Origem, princ√≠pios e fundamentos.</span>
          </div>
        </div>

        <div class="home-card clickable" id="card-hierarquia">
          <div class="home-card-icon">üßë‚Äçü§ù‚Äçüßë</div>
          <div>
            <strong>Hierarquia da Casa</strong><br>
            <span class="muted">Quem √© quem no TUFDS.</span>
          </div>
        </div>

        <div class="home-card clickable" id="card-orixas">
          <div class="home-card-icon">‚ö°</div>
          <div>
            <strong>Orix√°s na Umbanda</strong><br>
            <span class="muted">For√ßas, linhas e fundamentos.</span>
          </div>
        </div>

        <div class="home-card clickable" id="card-ritual">
          <div class="home-card-icon">üïØ</div>
          <div>
            <strong>Ritual da gira</strong><br>
            <span class="muted">Passo a passo da gira.</span>
          </div>
        </div>

        <!-- NOVO CARD DOA√á√ïES -->
        <div class="home-card clickable" id="card-doacoes">
          <div class="home-card-icon">üíö</div>
          <div>
            <strong>Doa√ß√µes para a Casa</strong><br>
            <span class="muted">Veja o que o terreiro precisa e escolha como ajudar.</span>
          </div>
        </div>

        <!-- NOVO CARD PEDIDOS -->
        <div class="home-card clickable" id="card-pedidos">
          <div class="home-card-icon">üåπ</div>
          <div>
            <strong>Pedidos de Rosas & Itens</strong><br>
            <span class="muted">Reserve rosas, velas e outros itens para a gira.</span>
          </div>
        </div>



      </div>
    </div>
    <!-- ======================= PEDIDOS CONSULENTES ======================= -->

        <div id="sec-pedidos" class="section">
          <div class="card">
          <h2>Pedidos para Giras</h2>
        <?!= include('Pedidos'); ?>
         </div>
     </div>


    <!-- ======================= CALEND√ÅRIO ======================= -->
    <div id="sec-calendario" class="section">
      <div class="card">
        <h2>Calend√°rio de Giras</h2>
        <p class="muted">Datas puxadas automaticamente da aba Calend√°rio.</p>

        <div class="cal-toolbar">
          <label>Filtrar por m√™s:</label>
          <select id="calMesSelect" class="cal-select">
            <option value="">Todos</option>
          </select>
        </div>

        <div id="calLista" class="cal-list"></div>
      </div>
    </div>

    <!-- ======================= DOA√á√ïES ======================= -->
    <div id="sec-doacoes" class="section">
      <div class="card">
        <h2>Doa√ß√µes</h2>
        <?!= include('Doacoes'); ?>
      </div>
    </div>

    <!-- ======================= BIBLIOTECA ======================= -->
    <div id="sec-biblioteca" class="section">
      <div class="card">
        <h2>Biblioteca</h2>
        <?!= include('Biblioteca'); ?>
      </div>
    </div>

    <!-- ======================= SOBRE ======================= -->
    <div id="sec-sobre" class="section">
      <div class="card">
        <div class="sobre-tabs">
          <button class="sobre-tab-btn active" data-sobre="info">Sobre o TUFDS</button>
          <button class="sobre-tab-btn" data-sobre="historia">Hist√≥ria da Umbanda</button>
          <button class="sobre-tab-btn" data-sobre="visitantes">Orienta√ß√µes para Visitantes</button>
          <button class="sobre-tab-btn" data-sobre="primeiros">Primeiros Passos</button>
          <button class="sobre-tab-btn" data-sobre="hierarquia">Hierarquia da Casa</button>
          <button class="sobre-tab-btn" data-sobre="ritual">Ritual da Gira</button>
        </div>
      </div>

      <div id="sobre-info" class="sobre-panel card active">
        <?!= include('SobreTUFDS'); ?>
      </div>

      <div id="sobre-historia" class="sobre-panel card">
        <?!= include('HistUmbanda'); ?>
      </div>

      <div id="sobre-visitantes" class="sobre-panel card">
        <?!= include('Visitantes'); ?>
      </div>

      <div id="sobre-primeiros" class="sobre-panel card">
        <?!= include('PrimeirosPassos'); ?>
      </div>

      <div id="sobre-hierarquia" class="sobre-panel card">
        <?!= include('Hierarquia'); ?>
      </div>

      <div id="sobre-ritual" class="sobre-panel card">
        <?!= include('RitualTUFDS'); ?>
      </div>
    </div>

    <!-- ======================= ORIX√ÅS ======================= -->
    <div id="sec-orixas" class="section">
      <div class="card">
        <h2>Orix√°s</h2>
        <?!= include('Orixas'); ?>
      </div>
    </div>

    <!-- ======================= PONTOS / PLAYLISTS / FAQ / CONTATO ======================= -->

    <div id="sec-pontos" class="section">
  <div class="card">
    <h2>Pontos Cantados</h2>
    <?!= include('Pontos'); ?>
  </div>
</div>


    <div id="sec-playlists" class="section">
      <div class="card"><h2>Playlists</h2></div>
    </div>

    <div id="sec-faq" class="section">
      <div class="card"><h2>Perguntas Frequentes</h2></div>
    </div>

    <div id="sec-contato" class="section">
      <div class="card">
        <?!= include('Contato'); ?>
      </div>
    </div>

  </div>

  <!-- ======================= COLUNA DIREITA ======================= -->
  <div class="col-right">
    <div class="card">
      <h2>Espa√ßo do TUFDS</h2>
      <p class="muted">Terreiro de Umbanda Filhos do Sagrado ‚Äì Manaus/AM</p>
      <h3 style="margin-top:14px;">Pr√≥ximas giras</h3>
      <div id="homeProximasLista"></div>
    </div>
  </div>

</div>

<!-- ======================= MODAL NEWSLETTER ======================= -->
<div id="newsletter-modal" class="newsletter-backdrop hidden">
  <div class="newsletter-card">
    <h2>Quer receber nossos avisos?</h2>
    <p>Deixe seu e-mail para receber comunicados do terreiro.</p>
    <input type="email" id="newsletter-email" placeholder="seuemail@exemplo.com">
    <div class="newsletter-actions">
      <button type="button" onclick="fecharNewsletterModal()" class="btn-secundario">Agora n√£o</button>
      <button type="button" onclick="enviarNewsletterEmail()" class="btn-primario">Quero receber</button>
    </div>
  </div>
</div>

<!-- ======================= SCRIPTS ======================= -->
<script>
/* ===== Abas principais ===== */
const tabs = document.querySelectorAll('.tab-btn');
const sections = document.querySelectorAll('.section');

tabs.forEach(btn=>{
  btn.addEventListener('click',()=>{
    tabs.forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');

    const tab = btn.dataset.tab;
    sections.forEach(sec=>{
      sec.classList.toggle('active', sec.id===`sec-${tab}`);
    });
  });
});

/* ===== Sub-abas (Sobre) ===== */
const sobreBtns = document.querySelectorAll('.sobre-tab-btn');
const sobrePanels = document.querySelectorAll('.sobre-panel');

sobreBtns.forEach(btn => {
  btn.addEventListener('click', () => {
    sobreBtns.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const key = btn.dataset.sobre;
    sobrePanels.forEach(panel => {
      panel.classList.toggle('active', panel.id === `sobre-${key}`);
    });
  });
});

/* ===== Cards que abrem abas ===== */
const cardDoacoes = document.getElementById('card-doacoes');
if (cardDoacoes) {
  cardDoacoes.addEventListener('click', () => {
    document.querySelector('.tab-btn[data-tab="doacoes"]')?.click();
  });
}
const cardBib = document.getElementById('card-biblioteca');
if (cardBib) {
  cardBib.addEventListener('click', () => {
    document.querySelector('.tab-btn[data-tab="biblioteca"]')?.click();
  });
}

/* ===== Calend√°rio ===== */
let eventosCalendario = [];
const calSelect = document.getElementById('calMesSelect');
const calLista = document.getElementById('calLista');
const homeProxLista = document.getElementById('homeProximasLista');

function carregarCalendario(){
  google.script.run
    .withSuccessHandler(res=>{
      eventosCalendario = res.eventos || [];
      montarFiltroMeses();
      renderCalendario();
      renderHomeProximas();
    })
    .getCalendarioEventos();
}

function montarFiltroMeses(){
  calSelect.innerHTML = '<option value="">Todos</option>';
  const uniq={};
  eventosCalendario.forEach(ev=>{
    if(ev.mesAnoKey && !uniq[ev.mesAnoKey]){
      const [ano,mes] = ev.mesAnoKey.split('-');
      const nomes=['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'];
      uniq[ev.mesAnoKey] = `${nomes[parseInt(mes)-1]}/${ano}`;
    }
  });
  Object.keys(uniq).sort().forEach(key=>{
    const opt=document.createElement('option');
    opt.value=key;
    opt.textContent=uniq[key];
    calSelect.appendChild(opt);
  });
}

function renderCalendario(){
  calLista.innerHTML='';
  let lista = eventosCalendario;
  if(calSelect.value){
    lista = eventosCalendario.filter(ev=>ev.mesAnoKey===calSelect.value);
  }
  if(!lista.length){
    calLista.innerHTML='<div class="muted">Nenhuma gira neste m√™s.</div>';
    return;
  }
  lista.forEach(ev=>{
    let nome = ev.linha || ev.atividade || '';
    if(nome.toLowerCase().startsWith('atividade ')){
      nome = nome.substring(10);
    }
    const [dia,mes,ano] = ev.dataStr.split('/');
    const item=document.createElement('div');
    item.className='cal-item';
    item.innerHTML=`
      <div class="cal-date">
        <div class="dia">${dia}</div>
        <div>${mes}/${ano}</div>
      </div>
      <div class="cal-main">
        <div class="cal-title">Gira ${nome}</div>
      </div>`;
    calLista.appendChild(item);
  });
}
calSelect?.addEventListener('change',renderCalendario);

/* ===== Pr√≥ximas giras (coluna direita) ===== */
function renderHomeProximas(){
  homeProxLista.innerHTML='';
  if(!eventosCalendario.length){
    homeProxLista.innerHTML='<p class="muted">Sem giras cadastradas.</p>';
    return;
  }
  const hojeISO = new Date().toISOString().replace(/T.*/,'');
  const proximas = eventosCalendario.filter(ev=>ev.iso >= hojeISO).slice(0,4);
  proximas.forEach(ev=>{
    let nome = ev.linha || ev.atividade || '';
    if(nome.toLowerCase().startsWith('atividade ')){
      nome = nome.substring(10);
    }
    const div=document.createElement('div');
    div.style.marginBottom='10px';
    div.innerHTML=`
      <div style="background:#d1fae5;padding:6px 10px;border-radius:12px;
                  display:flex;justify-content:space-between;align-items:center;">
        <span>${ev.dataStr}</span>
        <strong>Gira ${nome}</strong>
      </div>`;
    homeProxLista.appendChild(div);
  });

}
  const cardPedidos = document.getElementById('card-pedidos');
    if (cardPedidos) {
  cardPedidos.addEventListener('click', () => {
    document.querySelector('.tab-btn[data-tab="pedidos"]')?.click();
  });
}


/* ===== Newsletter ===== */
function abrirNewsletterModal() {
  document.getElementById('newsletter-modal')?.classList.remove('hidden');
}
function fecharNewsletterModal() {
  const modal = document.getElementById('newsletter-modal');
  if (modal) modal.classList.add('hidden');
  localStorage.setItem('tufds_newsletter_shown', '1');
}
function enviarNewsletterEmail() {
  const email = document.getElementById('newsletter-email')?.value.trim();
  if (!email) return alert('Digite seu e-mail.');
  google.script.run
    .withSuccessHandler(() => {
      alert('E-mail cadastrado com sucesso!');
      fecharNewsletterModal();
    })
    .salvarEmailNewsletter(email);
}

/* ===== Boot ===== */
document.addEventListener('DOMContentLoaded', function () {
  carregarCalendario();
  const jaMostrou = localStorage.getItem('tufds_newsletter_shown');
  if (!jaMostrou) abrirNewsletterModal();
});
</script>

</body>
</html>
