<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Lista de Presença – TUFDS</title>
<style>
  body{font-family:Arial,sans-serif;background:#f8f9fb;margin:0;color:#333}
  .container{max-width:820px;margin:28px auto;background:#fff;padding:26px;border-radius:16px;box-shadow:0 0 10px rgba(0,0,0,.08)}
  h1{margin:0 0 14px}
  label{font-weight:700;display:block;margin:10px 0 6px}
  select,input,textarea{width:100%;padding:10px;border:1px solid #ccc;border-radius:8px;font-size:14px}
  textarea{min-height:80px}
  .actions{display:flex;justify-content:flex-end;margin-top:14px}
  button{background:#111827;color:#fff;border:0;padding:10px 18px;border-radius:8px;cursor:pointer;font-weight:700}
  button:hover{background:#333}
  #msg{display:none;margin-top:12px;padding:10px;border-radius:8px;text-align:center;font-weight:700}
  #msg.ok{background:#e8f5e9;color:#256029}
  #msg.err{background:#fdecea;color:#a12721}
  .hint{font-size:13px;color:#666;margin-top:-6px}
</style>
</head>
<body>
  <div id="presenca-root" class="container">
    <h1>Lista de Presença – TUFDS</h1>
    <p class="hint">Preencha seu nome. (Somente os nomes ativos da aba Cadastro.)</p>

    <label>Nome</label>
    <select id="nome"></select>

    <label>Observação (opcional)</label>
    <textarea id="observacao" placeholder="Atraso, justificativa, etc."></textarea>

    <div class="actions">
      <button id="enviar">Registrar Presença</button>
    </div>

    <div id="msg"></div>
  </div>

<script>
(() => {
  const ROOT = document.getElementById('presenca-root');
  if (!ROOT || ROOT.dataset.inited === '1') return;
  ROOT.dataset.inited = '1';

  const $ = (sel) => ROOT.querySelector(sel);

  function showMsg(ok, text){
    const msg = $('#msg');
    msg.className = ok ? 'ok' : 'err';
    msg.textContent = text;
    msg.style.display = 'block';
    if (ok) setTimeout(()=> msg.style.display='none', 4000);
  }

  // Carrega somente os nomes ativos da aba Cadastro
  (async () => {
    try {
      const r = await fetch('/api/presencas/init.js');
      const raw = await r.text();
      let j; try { j = JSON.parse(raw); } catch { throw new Error('Resposta não-JSON: ' + raw); }
      if (!j.ok) throw new Error(j.message || 'Falha ao carregar nomes');

      const nomes = j.nomes || [];
      const sel = $('#nome');
      sel.innerHTML = '<option value="">Selecione...</option>' +
        nomes.map(n => `<option>${n}</option>`).join('');

      if (!nomes.length) showMsg(false, 'Nenhum nome ativo encontrado.');
    } catch(e) {
      showMsg(false, 'Erro ao carregar nomes: ' + (e.message || e));
    }
  })();

  // Envio placeholder (mantenho para você plugar no backend quando quiser)
  $('#enviar').addEventListener('click', async () => {
    const nome = $('#nome').value.trim();
    const obs  = $('#observacao').value.trim();
    if (!nome) return showMsg(false, 'Selecione seu nome.');

    // Aqui você conecta no endpoint real quando quiser registrar na planilha.
    showMsg(true, `✅ Presença registrada (demo) para ${nome}${obs ? ' — ' + obs : ''}`);
    $('#observacao').value = '';
  });
})();
</script>
</body>
</html>

