<style>
  .aniv-wrap { font-family: Arial, sans-serif; }
  .aniv-container { max-width: 900px; margin: 0 auto; padding: 30px; }

  .aniv-title { font-size: 32px; margin: 0 0 8px; color: #0f766e; }
  .aniv-desc { color: #555; margin-bottom: 18px; }

  .aniv-filtros {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    align-items: center;
    margin-bottom: 16px;
  }
  .aniv-filtros select {
    padding: 8px 12px;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 15px;
    background: #fff;
  }
  .aniv-badge {
    font-size: 13px;
    background: #e0f2fe;
    color: #075985;
    padding: 4px 10px;
    border-radius: 999px;
  }

  .aniv-table { width: 100%; border-collapse: collapse; margin-top: 8px; }
  .aniv-table th, .aniv-table td {
    padding: 10px 8px;
    border-bottom: 1px solid #e5e7eb;
    text-align: left;
  }
  .aniv-table th { background: #f9fafb; font-size: 14px; }
  .aniv-table td { font-size: 14px; }
  .aniv-table td.data { width: 80px; text-align: center; font-weight: 600; }

  .aniv-empty {
    margin-top: 12px;
    font-size: 14px;
    color: #6b7280;
  }

  @media (max-width: 600px) {
    .aniv-container { padding: 18px; }
    .aniv-title { font-size: 24px; }
  }
</style>

<div class="aniv-wrap">
  <div class="aniv-container">
    <h2 class="aniv-title">Aniversariantes do TUFDS</h2>
    <p class="aniv-desc">Consulte os aniversariantes por mês e celebre junto com os filhos do Sagrado.</p>

    <div class="aniv-filtros">
      <label for="anivMes">Mês:</label>
      <select id="anivMes">
        <option value="1">Janeiro</option>
        <option value="2">Fevereiro</option>
        <option value="3">Março</option>
        <option value="4">Abril</option>
        <option value="5">Maio</option>
        <option value="6">Junho</option>
        <option value="7">Julho</option>
        <option value="8">Agosto</option>
        <option value="9">Setembro</option>
        <option value="10">Outubro</option>
        <option value="11">Novembro</option>
        <option value="12">Dezembro</option>
      </select>
      <span id="anivBadge" class="aniv-badge" style="display:none"></span>
    </div>

    <div id="anivLista"></div>
  </div>
</div>

<script>
(async function(){
  const sel = document.getElementById('anivMes');
  const lista = document.getElementById('anivLista');
  const badge = document.getElementById('anivBadge');

  const meses = [
    'Janeiro','Fevereiro','Março','Abril','Maio','Junho',
    'Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'
  ];

  const fmtNome = s => String(s||'').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  const fmtData = s => String(s||'').replace(/^0/,'').trim();

  async function carregar(mes){
    try{
      const res = await fetch(`/api/aniversariantes.js?mes=${mes}`);
      const data = await res.json();

      const anivers = data?.aniversariantes || [];
      const mesNome = data?.mesNome || meses[mes-1];

      sel.value = data?.mesNumero || mes;
      badge.style.display = 'inline-block';
      badge.textContent = mesNome;

      if(!anivers.length){
        lista.innerHTML = '<div class="aniv-empty">Nenhum aniversariante encontrado para este mês.</div>';
        return;
      }

      let html = `
        <table class="aniv-table">
          <thead><tr><th>Nome</th><th class="data">Dia</th></tr></thead>
          <tbody>
      `;
      anivers.forEach(p=>{
        html += `<tr><td>${fmtNome(p.nome)}</td><td class="data">${fmtData(p.data)}</td></tr>`;
      });
      html += '</tbody></table>';
      lista.innerHTML = html;

    }catch(e){
      console.error(e);
      lista.innerHTML = `<div class="aniv-empty">Erro ao carregar aniversariantes.</div>`;
    }
  }

  sel.addEventListener('change',()=>carregar(sel.value));

  // Carrega mês atual
  const mesAtual = new Date().getMonth()+1;
  carregar(mesAtual);
})();
</script>

