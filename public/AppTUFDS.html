<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>App TUFDS ‚Äì Consulentes</title>

<script src="/gsrun.js"></script>

<style>
  :root{
    --bg:#f3f4f6;
    --card:#ffffff;
    --text:#111827;
    --muted:#6b7280;
    --border:#e5e7eb;
    --accent:#0f766e;
    --accent-strong:#0b5f59;
    --accent-soft:#ecfdf5;
    --shadow:0 1px 3px rgba(0,0,0,.06);
    --radius:16px;
  }

  *{ box-sizing:border-box }
  html,body{ height:100% }
  body{
    margin:0;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue","Noto Sans",Arial,"Apple Color Emoji","Segoe UI Emoji";
    background:var(--bg);
    color:var(--text);
  }

  .shell{
    max-width:1200px;
    margin:0 auto;
    padding:24px 16px 40px;
    display:grid;
    grid-template-columns: 1fr 320px;
    gap:24px;
  }
  .shell.single{ grid-template-columns: 1fr; }
  @media (max-width: 1024px){ .shell{ grid-template-columns: 1fr } }

  .hidden{ display:none !important; }

  /* header */
  .header{
    grid-column:1 / -1;
    background:var(--card);
    border:1px solid var(--border);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:16px 20px;
    display:flex;
    align-items:center;
    gap:14px;
  }
  .logo-circle{
    width:56px;height:56px;border-radius:50%;
    background:var(--accent-soft);
    border:1px solid #a7f3d0;
    color:var(--accent);
    display:grid;place-items:center;
    font-weight:800;font-size:22px;
    flex:0 0 56px;
    overflow:hidden;
  }
  .logo-circle img{ width:100%; height:100%; object-fit:cover; display:block }
  .header h1{ margin:0;font-size:24px;line-height:1.15; }
  .sub{ color:var(--muted); margin-top:2px; font-size:14px }

  /* tabs */
  .tabs{
    grid-column:1 / -1;
    display:flex; flex-wrap:wrap; gap:10px;
    margin-top:12px; margin-bottom:10px;
  }
  .tab-btn{
    border:1px solid var(--border);
    background:#fff;
    color:var(--text);
    padding:10px 16px;
    border-radius:999px;
    font-weight:600;
    font-size:15px;
    cursor:pointer;
    user-select:none;
  }
  .tab-btn.active{
    background:var(--accent);
    border-color:var(--accent);
    color:#ecfdf5;
  }

  /* cards / sections */
  .card{
    background:var(--card);
    border:1px solid var(--border);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:20px;
  }
  h2{ margin:0 0 8px 0; font-size:22px }
  .muted{ color:var(--muted); font-size:14px }

  .section{ display:none; }
  .section.active{ display:block; }

  .home-grid{
    margin-top:10px;
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:16px;
  }
  @media (max-width: 720px){ .home-grid{ grid-template-columns: 1fr } }

  .home-card{
    display:flex; align-items:center; gap:14px;
    background:#fff; border:1px solid var(--border);
    padding:18px; border-radius:14px; cursor:pointer;
    transition:transform .08s ease, background .15s ease, box-shadow .15s ease;
  }
  .home-card:hover{ background:#f9fafb; transform:translateY(-1px); box-shadow:0 1px 3px rgba(0,0,0,.08) }
  .home-card-icon{
    width:44px;height:44px;border-radius:12px;
    display:grid;place-items:center;font-size:26px;
    background:#eef2ff;
  }
  .home-card strong{ font-size:18px; display:block; margin-bottom:4px }

  /* calend√°rio & sidebar */
  .cal-toolbar{ display:flex; align-items:center; gap:10px; margin-bottom:10px; }
  .cal-select{ padding:8px 12px; border:1px solid var(--border); border-radius:10px; background:#fff; font-size:14px; }
  .cal-list{ display:flex; flex-direction:column; gap:12px }
  .cal-item{ display:flex; gap:12px; align-items:center; background:#fff; border:1px solid var(--border); border-radius:12px; padding:12px; }
  .cal-date{ min-width:78px; text-align:center; color:var(--accent); background:var(--accent-soft); border-radius:10px; padding:8px 6px; font-weight:700; }
  .cal-date .dia{ font-size:22px }
  .cal-title{ font-size:16px; font-weight:700 }

  .side-title{ font-weight:800; font-size:26px; margin:0 0 8px 0 }
  .next-list{ display:flex; flex-direction:column; gap:10px; margin-top:6px }
  .next-item{ background:#d1fae5; border-radius:14px; padding:10px 12px; display:flex; justify-content:space-between; gap:16px; align-items:center; }
  .next-date{ font-weight:600 }
  .next-badge{ background:#10b981; color:#052e1b; font-weight:800; padding:6px 12px; border-radius:999px; white-space:nowrap; }

  /* newsletter */
  .newsletter-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,.55); display:flex; align-items:center; justify-content:center; z-index:50 }
  .newsletter-backdrop.hidden{ display:none }
  .newsletter-card{ background:#fff; width:min(420px,92%); padding:24px 20px; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.3) }
  .newsletter-card h2{ font-size:20px }
  #newsletter-email{ width:100%; padding:10px 12px; border:1px solid #ccc; border-radius:8px; margin-top:8px }
  .newsletter-actions{ display:flex; justify-content:flex-end; gap:8px; margin-top:12px }
  .btn-primario,.btn-secundario{ border:0; border-radius:999px; padding:8px 16px; font-size:14px; cursor:pointer }
  .btn-primario{ background:var(--accent); color:#fff }
  .btn-secundario{ background:#e5e7eb; color:#111827 }

  /* sub-abas sobre */
  .sobre-panel{ display:none; }
  .sobre-panel.active{ display:block; }
</style>
</head>
<body>

<div class="shell" id="app-shell">

  <!-- HEADER -->
  <div class="header">
    <div class="logo-circle" id="logoCircle" aria-label="Logo TUFDS">
      <!-- fallback (T) √© substitu√≠do por <img> abaixo -->
      T
    </div>
    <div>
      <h1>Terreiro de Umbanda Filhos do Sagrado - TUFDS</h1>
      <div class="sub">Espa√ßo de f√©, acolhimento e aprendizado.</div>
    </div>
  </div>

  <!-- TABS -->
  <div class="tabs" id="tabs">
    <button class="tab-btn active" data-tab="home">In√≠cio</button>
    <button class="tab-btn" data-tab="calendario">Calend√°rio</button>
    <button class="tab-btn" data-tab="pontos">Pontos Cantados</button>
    <button class="tab-btn" data-tab="playlists">Playlists</button>
    <button class="tab-btn" data-tab="pedidos">Pedidos</button>
    <button class="tab-btn" data-tab="doacoes">Doa√ß√µes</button>
    <button class="tab-btn" data-tab="biblioteca">Biblioteca</button>
    <button class="tab-btn" data-tab="sobre">Sobre a Casa</button>
    <button class="tab-btn" data-tab="orixas">Orix√°s</button>
    <button class="tab-btn" data-tab="faq">Perguntas Frequentes</button>
    <button class="tab-btn" data-tab="contato">Contato</button>
  </div>

  <!-- COLUNA ESQUERDA -->
  <div>

    <!-- HOME -->
    <div id="sec-home" class="section active">
      <h1 style="margin:6px 0 6px;font-size:44px;line-height:1.1">Novo na Umbanda? Comece por aqui.</h1>

      <div class="home-grid" id="homeGrid">
        <div class="home-card" data-goto="primeiros">
          <div class="home-card-icon">üë£</div>
          <div><strong>Primeiros passos</strong><span class="muted">Orienta√ß√µes b√°sicas para sua primeira gira.</span></div>
        </div>

        <div class="home-card" data-goto="visitantes">
          <div class="home-card-icon">‚úÖ</div>
          <div><strong>Orienta√ß√µes para visitantes</strong><span class="muted">Como se portar e como pedir ajuda espiritual.</span></div>
        </div>

        <div class="home-card" data-tab="biblioteca">
          <div class="home-card-icon">üìö</div>
          <div><strong>Biblioteca</strong><span class="muted">Acesse apostilas, PDFs e materiais da casa.</span></div>
        </div>

        <div class="home-card" data-goto="historia">
          <div class="home-card-icon">üìñ</div>
          <div><strong>Hist√≥ria da Umbanda</strong><span class="muted">Origem, princ√≠pios e fundamentos.</span></div>
        </div>

        <div class="home-card" data-goto="hierarquia">
          <div class="home-card-icon">üßë‚Äçü§ù‚Äçüßë</div>
          <div><strong>Hierarquia da Casa</strong><span class="muted">Quem √© quem no TUFDS.</span></div>
        </div>

        <div class="home-card" data-tab="orixas">
          <div class="home-card-icon">‚ö°</div>
          <div><strong>Orix√°s na Umbanda</strong><span class="muted">For√ßas, linhas e fundamentos.</span></div>
        </div>

        <div class="home-card" data-goto="ritual">
          <div class="home-card-icon">üïØ</div>
          <div><strong>Ritual da gira</strong><span class="muted">Passo a passo da gira.</span></div>
        </div>

        <div class="home-card" data-tab="doacoes">
          <div class="home-card-icon">üíö</div>
          <div><strong>Doa√ß√µes para a Casa</strong><span class="muted">Veja o que o terreiro precisa e escolha como ajudar.</span></div>
        </div>

        <div class="home-card" data-tab="pedidos">
          <div class="home-card-icon">üåπ</div>
          <div><strong>Pedidos de Rosas & Itens</strong><span class="muted">Reserve rosas, velas e outros itens para a gira.</span></div>
        </div>
      </div>
    </div>

    <!-- PEDIDOS -->
    <div id="sec-pedidos" class="section">
      <div class="card">
        <h2>Pedidos para Giras</h2>
        <div data-include="/partials/Pedidos.html"></div>
      </div>
    </div>

    <!-- CALEND√ÅRIO -->
    <div id="sec-calendario" class="section">
      <div class="card">
        <h2>Calend√°rio de Giras</h2>
        <p class="muted">Datas puxadas automaticamente da aba Calend√°rio.</p>

        <div class="cal-toolbar">
          <label>Filtrar por m√™s:</label>
          <select id="calMesSelect" class="cal-select"><option value="">Todos</option></select>
        </div>
        <div id="calLista" class="cal-list"></div>
      </div>
    </div>

    <!-- DOA√á√ïES -->
    <div id="sec-doacoes" class="section">
      <div class="card">
        <h2>Doa√ß√µes</h2>
        <div data-include="/partials/Doacoes.html"></div>
      </div>
    </div>

    <!-- BIBLIOTECA -->
    <div id="sec-biblioteca" class="section">
      <div class="card">
        <h2>Biblioteca</h2>
        <div data-include="/partials/Biblioteca.html"></div>
      </div>
    </div>

    <!-- SOBRE -->
    <div id="sec-sobre" class="section">
      <div class="card" style="margin-bottom:12px">
        <div class="sobre-tabs">
          <button class="tab-btn sobre-tab-btn active" data-sobre="info">Sobre o TUFDS</button>
          <button class="tab-btn sobre-tab-btn" data-sobre="historia">Hist√≥ria da Umbanda</button>
          <button class="tab-btn sobre-tab-btn" data-sobre="visitantes">Orienta√ß√µes para Visitantes</button>
          <button class="tab-btn sobre-tab-btn" data-sobre="primeiros">Primeiros Passos</button>
          <button class="tab-btn sobre-tab-btn" data-sobre="hierarquia">Hierarquia da Casa</button>
          <button class="tab-btn sobre-tab-btn" data-sobre="ritual">Ritual da Gira</button>
        </div>
      </div>

      <div id="sobre-info" class="sobre-panel card active" data-include="/partials/SobreTUFDS.html"></div>
      <div id="sobre-historia" class="sobre-panel card" data-include="/partials/HistUmbanda.html"></div>
      <div id="sobre-visitantes" class="sobre-panel card" data-include="/partials/Visitantes.html"></div>
      <div id="sobre-primeiros" class="sobre-panel card" data-include="/partials/PrimeirosPassos.html"></div>
      <div id="sobre-hierarquia" class="sobre-panel card" data-include="/partials/Hierarquia.html"></div>
      <div id="sobre-ritual" class="sobre-panel card" data-include="/partials/RitualTUFDS.html"></div>
    </div>

    <!-- ORIX√ÅS -->
    <div id="sec-orixas" class="section">
      <div class="card" data-include="/partials/Orixas.html"></div>
    </div>

    <!-- PONTOS / PLAYLISTS / FAQ / CONTATO -->
    <div id="sec-pontos" class="section">
      <div class="card" data-include="/partials/Pontos.html"></div>
    </div>

    <div id="sec-playlists" class="section">
      <div class="card"><h2>Playlists</h2></div>
    </div>

    <div id="sec-faq" class="section">
      <div class="card"><h2>Perguntas Frequentes</h2></div>
    </div>

    <div id="sec-contato" class="section">
      <div class="card" data-include="/partials/Contato.html"></div>
    </div>

  </div>

  <!-- COLUNA DIREITA (s√≥ na Home) -->
  <aside class="col-right" id="side-panel">
    <div class="card">
      <h2 class="side-title">Espa√ßo do TUFDS</h2>
      <p class="muted">Terreiro de Umbanda Filhos do Sagrado ‚Äì Manaus/AM</p>
      <h3 style="margin:10px 0 8px">Pr√≥ximas giras</h3>
      <div id="homeProximasLista" class="next-list"></div>
    </div>
  </aside>

</div>

<!-- MODAL NEWSLETTER -->
<div id="newsletter-modal" class="newsletter-backdrop hidden">
  <div class="newsletter-card">
    <h2>Quer receber nossos avisos?</h2>
    <p>Deixe seu e-mail para receber comunicados do terreiro.</p>
    <input type="email" id="newsletter-email" placeholder="seuemail@exemplo.com" />
    <div class="newsletter-actions">
      <button type="button" onclick="fecharNewsletterModal()" class="btn-secundario">Agora n√£o</button>
      <button type="button" onclick="enviarNewsletterEmail()" class="btn-primario">Quero receber</button>
    </div>
  </div>
</div>

<script>
/* ========= util ========= */
function qs(sel,root=document){ return root.querySelector(sel); }
function qsa(sel,root=document){ return Array.from(root.querySelectorAll(sel)); }

/* ========= logo do Drive com fallback ========= */
(function mountLogo(){
  const el = document.getElementById('logoCircle');
  if(!el) return;
  const url = 'https://drive.google.com/thumbnail?id=1dvqBxgfETpSgK25tFL3d8Tf7-i3wGZA3';
  const img = new Image();
  img.alt = 'Logo TUFDS';
  img.onload = ()=>{ el.textContent=''; el.appendChild(img); };
  img.onerror = ()=>{ /* mant√©m o ‚ÄúT‚Äù */ };
  img.src = url;
})();

/* ========= includes (partials) ========= */
async function loadPartial(el) {
  const url = el.getAttribute('data-include');
  try {
    const resp = await fetch(url, { cache: 'no-store' });
    const html = await resp.text();
    el.innerHTML = html;

    // executa <script> internos (ordem preservada)
    const scripts = qsa('script', el);
    for (const old of scripts) {
      const s = document.createElement('script');
      if (old.type) s.type = old.type;
      if (old.src) s.src = old.src; else s.text = old.textContent || '';
      old.parentNode.replaceChild(s, old);
      await Promise.resolve();
    }

    el.dispatchEvent(new CustomEvent('partial:loaded', { bubbles:true, detail:{ url } }));

    // se for Orix√°s e existir init
    if (url.includes('/partials/Orixas.html') && typeof window.initOrixas === 'function') {
      window.initOrixas(el);
    }
  } catch (e) {
    console.error('Erro ao carregar partial', url, e);
    el.innerHTML = '<p class="muted">Conte√∫do indispon√≠vel.</p>';
  }
}
qsa('[data-include]').forEach(loadPartial);

async function ensureIncludeLoaded(panelEl){
  if (!panelEl) return;
  const html = (panelEl.innerHTML || '').trim();
  if (html && !/Conte√∫do indispon√≠vel/i.test(html)) return;
  await loadPartial(panelEl);
}

/* ========= layout: aside s√≥ na Home ========= */
const shell = document.getElementById('app-shell');
const sidePanel = document.getElementById('side-panel');
function setAsideVisible(on){
  if (!shell || !sidePanel) return;
  sidePanel.classList.toggle('hidden', !on);
  shell.classList.toggle('single', !on);
}

/* ========= Tabs (delega√ß√£o) ========= */
const tabsRoot = document.getElementById('tabs');
const sections = qsa('.section');

function activateTab(tab){
  // estado visual
  qsa('.tab-btn', tabsRoot).forEach(b=>b.classList.toggle('active', b.dataset.tab===tab));
  // conte√∫do
  sections.forEach(sec=>sec.classList.toggle('active', sec.id===`sec-${tab}`));
  // aside
  setAsideVisible(tab === 'home');

  // cargas condicionais
  if (tab === 'calendario') garanteCalendario();

  if (tab === 'sobre') {
    const ativo = qs('.sobre-panel.active') || document.getElementById('sobre-info');
    ensureIncludeLoaded(ativo);
  }

  if (tab === 'orixas') {
    const cont = qs('#sec-orixas [data-include="/partials/Orixas.html"]') || qs('#sec-orixas');
    if (typeof window.initOrixas === 'function' && cont) window.initOrixas(cont);
    cont?.addEventListener('partial:loaded', (ev)=>{
      if (ev.detail?.url?.includes('/partials/Orixas.html') && typeof window.initOrixas === 'function') {
        window.initOrixas(cont);
      }
    }, { once:true });
  }
}

tabsRoot.addEventListener('click', (ev)=>{
  const btn = ev.target.closest('.tab-btn');
  if(!btn) return;
  const tab = btn.dataset.tab;
  if(!tab) return;
  activateTab(tab);
});

/* ========= Sub-abas ‚ÄúSobre‚Äù ========= */
function abrirSobre(key){
  activateTab('sobre');
  const btns = qsa('.sobre-tab-btn');
  const panels = qsa('.sobre-panel');
  const alvoBtn = qs(`.sobre-tab-btn[data-sobre="${key}"]`);
  const alvo = document.getElementById(`sobre-${key}`);

  btns.forEach(b=>b.classList.remove('active'));
  alvoBtn?.classList.add('active');
  panels.forEach(p=>p.classList.remove('active'));
  if (alvo){ alvo.classList.add('active'); ensureIncludeLoaded(alvo); }
}

/* ========= Atalhos da Home (delega√ß√£o) ========= */
const homeGrid = document.getElementById('homeGrid');
homeGrid.addEventListener('click', (ev)=>{
  const card = ev.target.closest('.home-card');
  if(!card) return;

  const gotoTab = card.dataset.tab;
  const gotoSobre = card.dataset.goto;

  if (gotoTab){
    activateTab(gotoTab);
    return;
  }
  if (gotoSobre){
    abrirSobre(gotoSobre);
    return;
  }
});

/* ========= Calend√°rio / Sidebar ========= */
let eventosCalendario = [];
let calJaBuscou = false;

const calSelect     = document.getElementById('calMesSelect');
const calLista      = document.getElementById('calLista');
const homeProxLista = document.getElementById('homeProximasLista');

function setLoadingCalendario(on=true){
  if(!calLista) return;
  calLista.innerHTML = on ? '<div class="muted">Carregando calend√°rio...</div>' : '';
}

function parseDateToISO(any){
  if(!any) return null;
  if (any instanceof Date && !isNaN(any)) return any.toISOString().slice(0,10);
  if (typeof any === 'string'){
    // j√° ISO yyyy-mm-dd?
    if (/^\d{4}-\d{2}-\d{2}$/.test(any)) return any;
    // dd/mm/aaaa
    const m = any.match(/^(\d{2})\/(\d{2})\/(\d{4})$/);
    if (m){
      const [_,d,mm,yyyy] = m;
      return `${yyyy}-${mm}-${d}`;
    }
  }
  return null;
}
function isoToBr(iso){
  if(!iso) return '';
  const [y,m,d] = iso.split('-');
  return `${d}/${m}/${y}`;
}
function isoToMesAnoKey(iso){
  if(!iso) return '';
  const [y,m] = iso.split('-');
  return `${y}-${m}`;
}

function normalizaEventos(lista){
  return (lista||[]).map(ev=>{
    const iso = ev.iso || ev.isoDate || parseDateToISO(ev.dataStr) || parseDateToISO(ev.dataISO);
    const dataStr = ev.dataStr || isoToBr(iso);
    const mesAnoKey = ev.mesAnoKey || isoToMesAnoKey(iso);
    return {
      ...ev,
      iso, dataStr, mesAnoKey
    };
  }).filter(e=>e.iso).sort((a,b)=> a.iso.localeCompare(b.iso));
}

function garanteCalendario(){
  if (!calJaBuscou || !eventosCalendario.length) {
    carregarCalendario();
  } else {
    montarFiltroMeses();
    renderCalendario();
  }
}

async function carregarCalendario(){
  try {
    setLoadingCalendario(true);
    const res = await fetch('/api/getCalendarioEventos', { cache:'no-store' });
    const data = await res.json();

    calJaBuscou = true;
    eventosCalendario = normalizaEventos(data?.eventos || data || []);
    montarFiltroMeses();
    renderCalendario();
    renderHomeProximas();
    setLoadingCalendario(false);

  } catch (err) {
    console.error('Erro ao carregar calend√°rio:', err);
    if (calLista) calLista.innerHTML = `<div class="muted">Falha ao carregar a agenda.</div>`;
    if (homeProxLista) homeProxLista.innerHTML = `<p class="muted">N√£o foi poss√≠vel carregar as pr√≥ximas giras.</p>`;
  }
}

function montarFiltroMeses(){
  if(!calSelect) return;
  calSelect.innerHTML = '<option value="">Todos</option>';
  const nomes=['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'];
  const mapa={};
  eventosCalendario.forEach(ev=>{
    if(ev.mesAnoKey && !mapa[ev.mesAnoKey]){
      const [ano,mes]=ev.mesAnoKey.split('-');
      mapa[ev.mesAnoKey] = `${nomes[parseInt(mes,10)-1]}/${ano}`;
    }
  });
  Object.keys(mapa).sort().forEach(k=>{
    const o=document.createElement('option'); o.value=k; o.textContent=mapa[k];
    calSelect.appendChild(o);
  });
}

function renderCalendario(){
  if(!calLista) return;
  calLista.innerHTML='';
  let lista = eventosCalendario || [];
  if(calSelect?.value) lista = lista.filter(ev=>ev.mesAnoKey===calSelect.value);

  if(!lista.length){
    calLista.innerHTML='<div class="muted">Nenhuma gira neste m√™s.</div>';
    return;
  }

  lista.forEach(ev=>{
    let nome = ev.linha || ev.atividade || '';
    if (typeof nome === 'string' && nome.toLowerCase().startsWith('atividade ')) nome = nome.substring(10);
    const [ano,mes,dia] = ev.iso.split('-');
    const row=document.createElement('div');
    row.className='cal-item';
    row.innerHTML = `
      <div class="cal-date">
        <div class="dia">${dia||'--'}</div>
        <div>${mes||'--'}/${ano||'--'}</div>
      </div>
      <div class="cal-main">
        <div class="cal-title">Gira ${nome||''}</div>
      </div>`;
    calLista.appendChild(row);
  });
}
calSelect?.addEventListener('change', renderCalendario);

function renderHomeProximas(){
  if(!homeProxLista) return;
  homeProxLista.innerHTML='';
  if(!eventosCalendario.length){
    homeProxLista.innerHTML='<p class="muted">Sem giras cadastradas.</p>';
    return;
  }
  const hojeISO = new Date().toISOString().slice(0,10);
  const proximas = eventosCalendario.filter(ev=>ev.iso >= hojeISO).slice(0,4);
  if (!proximas.length){
    homeProxLista.innerHTML='<p class="muted">Nenhuma gira futura cadastrada.</p>';
    return;
  }
  proximas.forEach(ev=>{
    let nome = ev.linha || ev.atividade || '';
    if (typeof nome === 'string' && nome.toLowerCase().startsWith('atividade ')) nome = nome.substring(10);
    const item = document.createElement('div');
    item.className = 'next-item';
    item.innerHTML = `<span class="next-date">${ev.dataStr || isoToBr(ev.iso)}</span>
                      <span class="next-badge">Gira ${nome}</span>`;
    homeProxLista.appendChild(item);
  });
}

/* ========= newsletter ========= */
function abrirNewsletterModal(){ document.getElementById('newsletter-modal')?.classList.remove('hidden'); }
function fecharNewsletterModal(){ document.getElementById('newsletter-modal')?.classList.add('hidden'); localStorage.setItem('tufds_newsletter_shown','1'); }
function enviarNewsletterEmail(){ alert('Fun√ß√£o de newsletter desativada neste ambiente.'); }

/* ========= boot ========= */
document.addEventListener('DOMContentLoaded', ()=>{
  setAsideVisible(true);
  garanteCalendario();

  const jaMostrou = localStorage.getItem('tufds_newsletter_shown');
  if(!jaMostrou) abrirNewsletterModal();
});
</script>

</body>
</html>
