<h2>Orixás na Umbanda</h2>

<p>
  Uma das mais impressionantes marcas do estudo da Umbanda é a influência que os
  Orixás exercem em seus filhos — influência essa que não se descobre pela data
  de nascimento, mas por rituais próprios da religião.
</p>

<p>
  Aqui falamos dos Orixás que fazem parte da linha de trabalho do TUFDS, suas cores,
  fundamentos, arquétipos dos filhos, algumas ervas associadas e formas de entrega.
</p>

<p>
  Também incluímos referências de banhos e amalás, sempre dentro da forma como
  trabalhamos na casa.
</p>

<hr>

<h3 style="margin-top:24px;">Escolha um Orixá para conhecer</h3>

<!-- BOTÕES DOS ORIXÁS -->
<div class="orixa-buttons" style="
  display:grid;
  grid-template-columns:repeat(2,minmax(0,1fr));
  gap:10px;
  margin-top:16px;
">
  <button class="orixa-btn" data-orixa="oxala">Oxalá</button>
  <button class="orixa-btn" data-orixa="ogum">Ogum</button>
  <button class="orixa-btn" data-orixa="iansa">Iansã</button>
  <button class="orixa-btn" data-orixa="iemanja">Iemanjá</button>
  <button class="orixa-btn" data-orixa="oxum">Oxum</button>
  <button class="orixa-btn" data-orixa="xango">Xangô</button>
  <button class="orixa-btn" data-orixa="oxossi">Oxóssi</button>
  <button class="orixa-btn" data-orixa="obaluae">Obaluaê</button>
  <button class="orixa-btn" data-orixa="nana">Nanã</button>
</div>

<style>
  .orixa-btn{
    padding:10px 12px;
    font-size:14px;
    border-radius:999px;
    border:1px solid #e5e7eb;
    background:#f9fafb;
    cursor:pointer;
    text-align:center;
    transition:background 0.2s, transform 0.1s, box-shadow 0.1s;
    font-weight:600;
  }
  .orixa-btn:hover{
    background:#eef2ff;
    transform:translateY(-1px);
    box-shadow:0 1px 3px rgba(15,23,42,0.1);
  }
  .orixa-btn.active{
    background:#0f766e;
    color:#ecfdf5;
    border-color:#0f766e;
  }

  .orixa-conteudo-card{
    margin-top:20px;
    padding:18px 20px;
    border-radius:16px;
    border:1px solid #e5e7eb;
    background:#ffffff;
  }
</style>

<!-- ONDE O TEXTO DO ORIXÁ VAI APARECER -->
<div id="orixaConteudo" class="orixa-conteudo-card">
  <p class="muted">Selecione um Orixá para ver a descrição.</p>
</div>

<script>
/**
 * Inicializador chamado pela página-mãe DEPOIS que o partial é injetado
 * e também quando a aba "Orixás" é aberta.
 * rootEl: o container onde este partial foi inserido (o <div data-include="...">).
 */
window.initOrixas = function initOrixas(rootEl){
  // evita ligar eventos mais de uma vez
  const root = rootEl && rootEl.querySelector ? rootEl : document;
  if (root.__orixas_bound__) return;
  root.__orixas_bound__ = true;

  const btns = root.querySelectorAll('.orixa-btn');
  const container = root.querySelector('#orixaConteudo');

  if (!btns.length || !container) return; // nada a fazer

  const mapaArquivos = {
    oxala:   'Oxala',
    ogum:    'Ogum',
    iansa:   'Iansa',
    iemanja: 'Iemanja',
    oxum:    'Oxum',
    xango:   'Xango',
    oxossi:  'Oxossi',
    obaluae: 'Obaluae',
    nana:    'Nana'
  };

  function setLoading(on=true){
    if (!container) return;
    container.innerHTML = on
      ? '<p class="muted">Carregando…</p>'
      : '';
  }

  async function carregarOrixa(chave){
    const arquivo = mapaArquivos[chave];
    if (!arquivo || !container) return;

    setLoading(true);

    // 1) Preferência: Apps Script
    if (window.google && google.script && google.script.run && typeof google.script.run.getOrixaHtml === 'function') {
      google.script.run
        .withSuccessHandler(function(html){
          container.innerHTML = html || '<p class="muted">Sem conteúdo para este Orixá.</p>';
        })
        .withFailureHandler(function(err){
          container.innerHTML = '<p class="muted">Falha ao carregar o conteúdo.</p>';
          console.error('getOrixaHtml falhou:', err);
        })
        .getOrixaHtml(arquivo);
      return;
    }

    // 2) Fallback: endpoint REST do seu back (/api/orixa?name=)
    try{
      const resp = await fetch(`/api/orixa?name=${encodeURIComponent(arquivo)}`);
      if (!resp.ok) throw new Error('HTTP '+resp.status);
      const html = await resp.text();
      container.innerHTML = html || '<p class="muted">Sem conteúdo para este Orixá.</p>';
    }catch(e){
      console.error('Fallback falhou:', e);
      container.innerHTML = '<p class="muted">Conteúdo indisponível no momento.</p>';
    }
  }

  // liga os cliques (escopo no root para não misturar com outras abas)
  btns.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const chave = btn.dataset.orixa;

      // visual
      btns.forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');

      // carrega
      carregarOrixa(chave);
    });
  });

  // Seleção padrão (Oxalá)
  const btnOxala = root.querySelector('.orixa-btn[data-orixa="oxala"]');
  if (btnOxala && !btnOxala.classList.contains('active')) {
    btnOxala.classList.add('active');
    carregarOrixa('oxala');
  }
};
</script>
